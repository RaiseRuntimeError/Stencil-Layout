<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Page metadata -->
  <meta charset="UTF-8" />
  <title>Stencil Layout</title>

  <!-- Spectre.css framework -->
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">

  <!-- Preload important images for faster rendering -->
  <link rel="preload" as="image" href="freeway-overpass.webp" />
  <link rel="preload" as="image" href="seamless-canvas-fabric-texture.webp" />

  <!-- Google Fonts: Stardos Stencil -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Stardos+Stencil&display=swap" rel="stylesheet">

  <!-- Font Awesome (icons) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
    integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Lucide icon set -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Open Graph (for link previews on Facebook, LinkedIn, etc.) -->
  <meta property="og:title" content="Stencil Layout Helper" />
  <meta property="og:description" content="Plan your stencil layout with this helpful tool." />
  <meta property="og:image" content="https://raiseruntimeerror.github.io/Stencil-Layout/stencil-layout-preview.webp" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:url" content="https://raiseruntimeerror.github.io/Stencil-Layout" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card metadata -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Stencil Layout Helper" />
  <meta name="twitter:description" content="Plan your stencil layout with this helpful tool." />
  <meta name="twitter:image" content="https://raiseruntimeerror.github.io/Stencil-Layout/stencil-layout-preview.webp" />
  <meta name="twitter:image:alt" content="Freeway overpass with stencil layout background." />

  <script defer data-domain="raiseruntimeerror.github.io" src="https://plausible.io/js/script.js"></script>

  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }

    label,
    input,
    select,
    button {
      margin: 5px 0;
      display: block;
    }

    .canvas-size-container {
      display: flex;
      gap: 40px;
      align-items: flex-start;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .preset-group,
    .dimensions-group,
    .options-group {
      display: flex;
      flex-direction: column;
    }

    .dimension-group,
    .option-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .option-item>label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0;
    }

    #rowInputs {
      margin-top: 10px;
    }

    #rowInputs input {
      margin-bottom: 5px;
      width: 100%;
    }

    #canvasContainer {
      margin: 40px auto;
      border: 1px solid #ccc;
      max-width: 100%;
      max-height: 90vh;
      overflow: hidden;
      position: relative;
    }

    #canvasScaler {
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: top left;
    }

    #canvasWidthFt,
    #canvasWidthIn,
    #canvasHeightFt,
    #canvasHeightIn {
      width: 80px;
    }

    canvas {
      background-color: #fdfdfd;
      display: block;
    }

    /* Modal styles */
    #modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    #modal img {
      width: 100%;
      height: auto;
      display: block;
    }

    #modal div {
      position: relative;
      max-width: 90%;
      max-height: 90%;
    }

    #modalCanvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 2;
      pointer-events: none;
    }

    #dropClothOverlay {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 3;
      display: none;
      pointer-events: none;
    }

    #closeModal,
    #closeAboutModal {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10000;

    }

    .section-row {
      display: flex;
      justify-content: space-between;
      align-items: stretch;
      gap: 1.5rem;
      margin-top: 2rem;
      flex-wrap: wrap;
    }

    .section-column {
      flex: 1;
      min-width: 200px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .section-divider {
      width: 1px;
      background: #ccc;
      height: auto;
    }

    .section-icon {
      margin-bottom: 0.5rem;
      color: #666;
    }

    .section-icon svg {
      width: 32px;
      height: 32px;
    }

    .social-float {
      position: fixed;
      bottom: 20px;
      right: -10px;
      /* partially off screen */
      background: #eee;
      border: 2px solid #999;
      border-radius: 40px 0 0 40px;
      padding: 10px 15px 10px 20px;
      display: flex;
      gap: 12px;
      z-index: 10000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
      transition: right 0.3s ease;
    }

    .social-float:hover {
      right: 0;
    }

    .social-icon {
      color: #333;
      text-decoration: none;
      transition: color 0.2s;
    }

    .social-icon:hover {
      color: #000;
    }

    .social-icon svg {
      width: 24px;
      height: 24px;
    }

    .social-float-mobile .social-icon {
      font-size: 1.4em;
      width: 3rem;
      height: 3rem;
      line-height: 3rem;
    }
  </style>
</head>

<body>
  <h2 id="aboutModalTitle" class="m-0 text-error" style="font-family: 'Stardos Stencil', system-ui;">
    Stencil Layout Helper
  </h2>

  <div class="canvas-size-container">
    <div class="preset-group form-group">
      <label for="presetSize">Preset Canvas Size:</label>
      <select class="form-select" id="presetSize">
        <option value="custom">— Custom —</option>
        <option value="twin">3′3″ × 6′3″ — Twin Sheet</option>
        <option value="4x12">4 × 12 ft — $8.99</option>
        <option value="4x15">4 × 15 ft — $10.99</option>
        <option value="6x9">6 × 9 ft — $6.99</option>
        <option value="9x12">9 × 12 ft — $14.99</option>
        <option value="12x15">12 × 15 ft — $29.99</option>
      </select>
    </div>
    <div class="dimensions-group">
      <label>Canvas Width:</label>
      <div class="dimension-group form-group">
        <input class="form-input" type="number" id="canvasWidthFt" value="6" step="1" pattern="[0-9]*"
          inputmode="numeric"> ft
        <input class="form-input" type="number" id="canvasWidthIn" value="0" step="1" pattern="[0-9]*"
          inputmode="numeric"> in
      </div>
      <label>Canvas Height:</label>
      <div class="dimension-group form-group">
        <input class="form-input" type="number" id="canvasHeightFt" value="3" step="1" pattern="[0-9]*"
          inputmode="numeric"> ft
        <input class="form-input" type="number" id="canvasHeightIn" value="0" step="1" pattern="[0-9]*"
          inputmode="numeric"> in
      </div>
    </div>
    <div class="options-group">
      <div class="form-group option-item">
        <label for="stencilSize">Stencil Size:</label>
        <input type="range" id="stencilSlider" min="4" max="24" step="0.5" value="12" style="width: 150px;">
        <input class="form-input" type="number" id="stencilSize" value="12" step="0.5" min="1" style="width: 70px;"> in
      </div>
      <div class="option-item form-group">
        <label class="form-switch">
          <input type="checkbox" id="showGrid" checked>
          <i class="form-icon"></i> Show margin grid
        </label>
      </div>
      <div class="option-item form-group">
        <label for="gridSubdivision">Grid Subdivision:</label>
        <select class="form-select" id="gridSubdivision">
          <option value="1">1× cell</option>
          <option value="0.5" selected>½× cell</option>
          <option value="0.25">¼× cell</option>
        </select>
      </div>
    </div>
  </div>

  <div id="rowInputs" class="form-group"></div>

  <div id="canvasContainer">
    <div id="canvasScaler">
      <canvas id="stencilCanvas"></canvas>
    </div>
  </div>

  <!-- About Modal -->
  <div id="aboutModal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; justify-content:center; align-items:center; overflow:auto;">
    <div
      style="background:white; color:black; padding:20px; max-width:800px; width:90%; border-radius:8px; position:relative;">

      <button class="btn" id="closeAboutModal">Close</button>

      <!-- Modal Content -->
      <div class="container p-2" aria-labelledby="aboutModalTitle" aria-describedby="aboutModalBody">
        <header class="mb-2">
          <h3 id="aboutModalTitle" class="m-0 text-error" style="font-family: 'Stardos Stencil', system-ui;">
            Stencil Layout Helper
            Make Big, Readable Banners Fast
          </h3>
          <p id="aboutModalBody" class="text-dark">
            Plan bold, legible lettering on cheap drop cloths, bed sheets, or whatever fabric you’ve got
            for banner hangs, overpass holds, marches, rallies, and more. Remember, if it’s worth saying, it’s worth
            saying loudly!
          </p>
        </header>

        <section class="mb-2">
          <h5 class="m-0"><i data-lucide="hand" aria-hidden="true"></i> Quick start</h5>
          <ol class="mt-1">
            <li><strong>Pick a cloth size</strong> (or set custom width/height).</li>
            <li><strong>Choose stencil size</strong> (start with 12&quot; for overpasses; bigger is easier to read).
            </li>
            <li><strong>Type your lines</strong> into the rows. Keep it short, high-contrast, and punchy.</li>
            <li><strong>Use the grid</strong> to center and align letters; adjust subdivision for finer spacing.</li>
            <li><strong>Preview</strong> with “Preview on Overpass” and tweak until it pops.</li>
          </ol>
        </section>

        <section class="mb-2">
          <h5 class="m-0"><i data-lucide="megaphone" aria-hidden="true"></i> For two common tactics</h5>
          <div class="columns mt-1">
            <div class="column col-6">
              <p class="m-0"><strong>Banner hang (drop):</strong> prioritize <em>huge</em> letters, minimal words, high
                contrast.
                Plan attachment points and consider wind. (Always follow site rules and safety best practices.)</p>
            </div>
            <div class="column col-6">
              <p class="m-0"><strong>Banner holding (overpass/march):</strong> keep it ultra-readable at 60 mph:
                3–6 words, all caps, bold strokes. Test the preview and go bigger if it looks cramped.</p>
            </div>
          </div>
        </section>

        <section class="mb-2">
          <h5 class="m-0"><i data-lucide="ruler" aria-hidden="true"></i> Readability tips</h5>
          <ul class="mt-1">
            <li><strong>Fewer words &gt; more words.</strong> If you can’t read it in 3 seconds, shorten it.</li>
            <li><strong>High contrast:</strong> black on natural canvas or white on dark cloth.</li>
            <li><strong>Go big:</strong> 12–18&quot; letters for overpasses; 8–12&quot; works for sidewalks/streets.
            </li>
            <li><strong>All caps</strong> with generous letter spacing increases legibility at distance.</li>
          </ul>
        </section>

        <section class="mb-2">
          <h5 class="m-0"><i data-lucide="shopping-bag" aria-hidden="true"></i> Materials (cheap + durable)</h5>
          <div class="columns mt-1">
            <div class="column col-4">
              <p class="m-0"><strong>Drop cloths</strong></p>
              <a class="btn btn-link btn-sm"
                href="https://www.harborfreight.com/painting/painting-supplies/drop-cloths-sheeting/canvas-drop-cloths.html"
                target="_blank" rel="noopener">Harbor Freight Canvas Drop Cloths</a>
            </div>
            <div class="column col-4">
              <p class="m-0"><strong>Spray paint</strong></p>
              <a class="btn btn-link btn-sm"
                href="https://www.lowes.com/pd/Project-Source-10-OZ-PROJECT-SOURCE-FLAT-BLACK-ECONOMY-SPRAY-PAINT/5013990349"
                target="_blank" rel="noopener">Lowe’s Project Source Flat Black</a>
              <a class="btn btn-link btn-sm"
                href="https://www.homedepot.com/p/HDX-10-oz-All-Purpose-Flat-Black-Spray-Paint-AF79705UF/320161382"
                target="_blank" rel="noopener">Home Depot HDX Flat Black</a>
            </div>
            <div class="column col-4">
              <p class="m-0"><strong>Letter stencils</strong></p>
              <a class="btn btn-link btn-sm"
                href="https://www.ebay.com/sch/i.html?_nkw=12+inche+letter+stencils&_sacat=0&_from=R40&_trksid=p2332490.m570.l1313"
                target="_blank" rel="noopener">12&quot; Letter Stencils on eBay</a>
            </div>
          </div>
        </section>

        <section class="mb-2">
          <h5 class="m-0"><i data-lucide="share-2" aria-hidden="true"></i> Share this tool</h5>
          <p class="m-0">Got a crew who’d use this? Send them the link or hit the share buttons in the lower-right
            corner.</p>
        </section>

      </div>

    </div>
  </div>

  <button class="btn btn-primary" id="previewButton">Preview on Overpass</button>
  <button class="btn btn-secondary" id="aboutButton">
    <i data-lucide="info"></i>
  </button>

  <!-- Hidden preload image -->
  <img id="bgImagePreload" src="freeway-overpass.webp" style="display: none;" loading="eager" />
  <img id="canvasTexture" src="seamless-canvas-fabric-texture.webp" style="display: none;" loading="eager" />

  <!-- Modal for preview -->
  <div id="modal">
    <div>
      <img id="modalBg" src="freeway-overpass.webp" alt="Freeway Overpass"
        style="background-color: #c1c1c1; width: 100%; height: auto;" loading="eager">
      <div id="dropClothOverlay">
        <canvas id="dropClothCanvas"></canvas>
      </div>
      <button class="btn" id="closeModal">Close</button>
    </div>
  </div>

  <div class="section-row">
    <div class="section-column">
      <div class="section-icon">
        <i data-lucide="scroll"></i>
      </div>
      <a class="btn btn-link btn-sm"
        href="https://www.harborfreight.com/painting/painting-supplies/drop-cloths-sheeting/canvas-drop-cloths.html"
        target="_blank">
        Harbor Freight Canvas Drop Cloths
      </a>
    </div>

    <div class="section-divider"></div>

    <div class="section-column">
      <div class="section-icon">
        <i data-lucide="spray-can"></i>
      </div>
      <a class="btn btn-link btn-sm"
        href="https://www.lowes.com/pd/Project-Source-10-OZ-PROJECT-SOURCE-FLAT-BLACK-ECONOMY-SPRAY-PAINT/5013990349"
        target="_blank">
        Lowes Project Source Flat Black
      </a>
      <a class="btn btn-link btn-sm"
        href="https://www.homedepot.com/p/HDX-10-oz-All-Purpose-Flat-Black-Spray-Paint-AF79705UF/320161382"
        target="_blank">
        Home Depot HDX Flat Black
      </a>
    </div>

    <div class="section-divider"></div>

    <div class="section-column">
      <div class="section-icon">
        <i data-lucide="square-m"></i>
      </div>
      <a class="btn btn-link btn-sm"
        href="https://www.ebay.com/sch/i.html?_nkw=12+inche+letter+stencils&_sacat=0&_from=R40&_trksid=p2332490.m570.l1313"
        target="_blank">
        12-inch Letter Stencils on eBay
      </a>
    </div>
  </div>

  <div class="social-float">
    <!-- Copy Link -->
    <a href="#" class="social-icon" aria-label="Copy link" id="copyLinkButton">
      <i class="fa-solid fa-link"></i>
    </a>

    <!-- Facebook -->
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fraiseruntimeerror.github.io%2FStencil-Layout&quote=Use%20this%20tool%20to%20take%20over%20freeway%20overpasses!%20%23DemocracyWins%20%23TrumpstienFiles"
      target="_blank" class="social-icon" aria-label="Facebook">
      <i class="fa-brands fa-facebook"></i>
    </a>

    <!-- Tumblr -->
    <a href="https://www.tumblr.com/widgets/share/tool?canonicalUrl=https%3A%2F%2Fraiseruntimeerror.github.io%2FStencil-Layout&title=Stencil%20Layout%20Helper&caption=Use%20this%20tool%20to%20take%20over%20freeway%20overpasses!"
      target="_blank" class="social-icon" aria-label="Tumblr">
      <i class="fa-brands fa-tumblr"></i>
    </a>

    <!-- Reddit -->
    <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fraiseruntimeerror.github.io%2FStencil-Layout&title=Take%20over%20freeway%20overpasses%20with%20this%20Stencil%20Layout%20Helper!%20%23DemocracyWins%20%23TrumpstienFiles"
      target="_blank" class="social-icon" aria-label="Reddit">
      <i class="fa-brands fa-reddit-alien"></i>
    </a>

    <!-- Bluesky -->
    <a href="https://bsky.app/intent/compose?text=Use%20this%20tool%20to%20take%20over%20freeway%20overpasses!%20%23DemocracyWins%20%23TrumpstienFiles%20https%3A%2F%2Fraiseruntimeerror.github.io%2FStencil-Layout"
      target="_blank" class="social-icon" aria-label="Bluesky">
      <i class="fa-brands fa-bluesky"></i>
    </a>

    <!-- Pinterest -->
    <a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fraiseruntimeerror.github.io%2FStencil-Layout&media=https%3A%2F%2Fraiseruntimeerror.github.io%2FStencil-Layout%2Ffreeway-overpass.webp&description=Use%20this%20tool%20to%20take%20over%20freeway%20overpasses!"
      target="_blank" class="social-icon" aria-label="Pinterest">
      <i class="fa-brands fa-pinterest"></i>
    </a>
  </div>

  <script>
    const INCH_TO_PX = 10;
    const RULER_MARGIN = 27;
    const presets = {
      "twin": { w: 6.25, h: 3.25 },
      "6x9": { w: 9, h: 6 },
      "9x12": { w: 12, h: 9 },
      "4x12": { w: 12, h: 4 },
      "4x15": { w: 15, h: 4 },
      "12x15": { w: 15, h: 12 }
    };

    const presetSize = document.getElementById('presetSize');
    const canvasWidthFt = document.getElementById('canvasWidthFt');
    const canvasWidthIn = document.getElementById('canvasWidthIn');
    const canvasHeightFt = document.getElementById('canvasHeightFt');
    const canvasHeightIn = document.getElementById('canvasHeightIn');
    const stencilSlider = document.getElementById('stencilSlider');
    const stencilSizeInput = document.getElementById('stencilSize');
    const showGridCheckbox = document.getElementById('showGrid');
    const gridSubdivisionSelect = document.getElementById('gridSubdivision');
    const rowInputs = document.getElementById('rowInputs');
    const canvas = document.getElementById('stencilCanvas');
    const container = document.getElementById('canvasContainer');
    const ctx = canvas.getContext('2d');

    const copyLinkButton = document.getElementById('copyLinkButton');
    copyLinkButton.addEventListener('click', (e) => {
      e.preventDefault();
      const link = "https://raiseruntimeerror.github.io/Stencil-Layout";
      navigator.clipboard.writeText(link)
        .then(() => {
          // Optional: quick visual feedback
          copyLinkButton.innerHTML = '<i class="fa-solid fa-check"></i>';
          setTimeout(() => {
            copyLinkButton.innerHTML = '<i class="fa-solid fa-link"></i>';
          }, 1500);
        })
        .catch(err => {
          console.error('Failed to copy: ', err);
        });
    });

    function isMobileDevice() {
      return /Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent);
    }

    if (isMobileDevice()) {
      document.querySelector('.social-float')?.classList.add('social-float-mobile');
    }

    stencilSlider.addEventListener('input', () => {
      stencilSizeInput.value = stencilSlider.value;
      drawGrid();
    });

    stencilSizeInput.addEventListener('input', () => {
      const val = parseFloat(stencilSizeInput.value);
      if (!isNaN(val)) {
        stencilSlider.value = val;
        drawGrid();
      }
    });

    function getCanvasDimensionsInInches() {
      const wf = parseFloat(canvasWidthFt.value) || 0;
      const wi = parseFloat(canvasWidthIn.value) || 0;
      const hf = parseFloat(canvasHeightFt.value) || 0;
      const hi = parseFloat(canvasHeightIn.value) || 0;
      return { width: wf * 12 + wi, height: hf * 12 + hi };
    }

    function updateCanvasSize() {
      const { width, height } = getCanvasDimensionsInInches();
      const pxW = width * INCH_TO_PX;
      const pxH = height * INCH_TO_PX;
      canvas.width = pxW + RULER_MARGIN + 10;
      canvas.height = pxH + RULER_MARGIN + 10;
      container.style.width = canvas.width + 'px';
      container.style.height = canvas.height + 'px';
    }

    function createRowInput(index, maxChars) {
      const input = document.createElement('input');
      input.type = 'text';
      input.maxLength = maxChars;
      input.placeholder = `Row ${index} (max ${maxChars} chars)`;
      input.title = `Max ${maxChars} characters allowed`;
      input.addEventListener('input', drawGrid);
      return input;
    }

    function updateRows() {
      const { width, height } = getCanvasDimensionsInInches();
      const stencilSize = parseFloat(stencilSizeInput.value);
      const charsPerRow = Math.floor(width / stencilSize);
      const maxRows = Math.floor(height / stencilSize);
      const existing = Array.from(rowInputs.children);
      const values = existing.map(i => i.value);

      while (existing.length < maxRows) {
        rowInputs.appendChild(createRowInput(existing.length + 1, charsPerRow));
        existing.push(rowInputs.lastChild);
      }
      while (existing.length > maxRows) {
        rowInputs.removeChild(existing.pop());
      }
      existing.forEach((input, i) => {
        input.maxLength = charsPerRow;
        input.placeholder = `Row ${i + 1} (max ${charsPerRow} chars)`;
        input.value = (values[i] || '').slice(0, charsPerRow);
      });
    }

    function drawMarginGrid() {
      if (!showGridCheckbox.checked) return;
      const subdivision = parseFloat(gridSubdivisionSelect.value);
      const baseCell = parseFloat(stencilSizeInput.value) * INCH_TO_PX;
      const step = baseCell * subdivision;
      ctx.strokeStyle = 'rgba(150,150,150,0.3)';
      ctx.lineWidth = 1;
      for (let x = RULER_MARGIN; x <= canvas.width; x += step) {
        ctx.beginPath();
        ctx.moveTo(x, RULER_MARGIN);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = RULER_MARGIN; y <= canvas.height; y += step) {
        ctx.beginPath();
        ctx.moveTo(RULER_MARGIN, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }

    function drawRulers() {
      const { width, height } = getCanvasDimensionsInInches();
      const pxW = width * INCH_TO_PX;
      const pxH = height * INCH_TO_PX;
      const subdivision = parseFloat(gridSubdivisionSelect.value);
      const baseCell = parseFloat(stencilSizeInput.value) * INCH_TO_PX;
      const step = baseCell * subdivision;
      ctx.strokeStyle = '#000';
      ctx.fillStyle = '#000';
      ctx.lineWidth = 1;
      ctx.font = '10px Arial';

      ctx.beginPath();
      ctx.moveTo(RULER_MARGIN, RULER_MARGIN);
      ctx.lineTo(RULER_MARGIN + pxW, RULER_MARGIN);
      ctx.stroke();

      for (let x = 0; x <= pxW; x += step) {
        const tick = subdivision === 1 ? 15 : 10;
        ctx.beginPath();
        ctx.moveTo(RULER_MARGIN + x, RULER_MARGIN);
        ctx.lineTo(RULER_MARGIN + x, RULER_MARGIN - tick);
        ctx.stroke();
        const val = (x / INCH_TO_PX).toFixed(2).replace(/\.00$/, '');
        ctx.textAlign = 'center';
        ctx.textBaseline = 'bottom';
        ctx.fillText(`${val}\"`, RULER_MARGIN + x, RULER_MARGIN - tick - 2);
      }

      ctx.beginPath();
      ctx.moveTo(RULER_MARGIN, RULER_MARGIN);
      ctx.lineTo(RULER_MARGIN, RULER_MARGIN + pxH);
      ctx.stroke();

      for (let y = 0; y <= pxH; y += step) {
        const tick = subdivision === 1 ? 15 : 10;
        ctx.beginPath();
        ctx.moveTo(RULER_MARGIN, RULER_MARGIN + y);
        ctx.lineTo(RULER_MARGIN - tick, RULER_MARGIN + y);
        ctx.stroke();
        const val = (y / INCH_TO_PX).toFixed(2).replace(/\.00$/, '');
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText(`${val}\"`, RULER_MARGIN - tick - 2, RULER_MARGIN + y);
      }
    }

    function scaleCanvasToFit() {
      const canvas = document.getElementById('stencilCanvas');
      const container = document.getElementById('canvasContainer');
      const scaler = document.getElementById('canvasScaler');

      const canvasWidth = canvas.width;
      const canvasHeight = canvas.height;
      const containerWidth = container.clientWidth;
      const containerHeight = container.clientHeight;

      const scaleX = containerWidth / canvasWidth;
      const scaleY = containerHeight / canvasHeight;
      const scale = Math.min(1, scaleX, scaleY); // Only downscale

      const offsetX = (containerWidth - canvasWidth * scale) / 2;
      const offsetY = (containerHeight - canvasHeight * scale) / 2;

      scaler.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
    }

    function drawGrid() {
      updateCanvasSize();
      updateRows();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#f0f0f0';
      ctx.fillRect(0, 0, canvas.width, RULER_MARGIN);
      ctx.fillRect(0, 0, RULER_MARGIN, canvas.height);
      drawMarginGrid();
      drawRulers();
      scaleCanvasToFit();

      const { width, height } = getCanvasDimensionsInInches();
      const pxW = width * INCH_TO_PX;
      const pxH = height * INCH_TO_PX;
      ctx.strokeStyle = '#999';
      ctx.lineWidth = 2;
      ctx.strokeRect(RULER_MARGIN, RULER_MARGIN, pxW, pxH);

      const rows = Array.from(rowInputs.children).map(i => i.value.toUpperCase());
      const cellSize = parseFloat(stencilSizeInput.value) * INCH_TO_PX;
      const totalH = rows.length * cellSize;
      const startY = (pxH - totalH) / 2 + RULER_MARGIN;
      ctx.font = `${cellSize * 1}px "Stardos Stencil", Arial, sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#000';

      rows.forEach((text, r) => {
        const rowW = text.length * cellSize;
        const startX = (pxW - rowW) / 2 + RULER_MARGIN;
        for (let c = 0; c < text.length; c++) {
          const x = startX + c * cellSize;
          const y = startY + r * cellSize;
          ctx.strokeStyle = '#000';
          ctx.strokeRect(x, y, cellSize, cellSize);
          ctx.fillText(text[c], x + cellSize / 2, y + cellSize / 2 + cellSize * 0.15);
        }
      });
    }

    presetSize.addEventListener('change', () => {
      const sel = presetSize.value;
      if (presets[sel]) {
        const wFeet = Math.floor(presets[sel].w);
        const wInches = Math.round((presets[sel].w - wFeet) * 12);
        const hFeet = Math.floor(presets[sel].h);
        const hInches = Math.round((presets[sel].h - hFeet) * 12);

        canvasWidthFt.value = wFeet;
        canvasWidthIn.value = wInches;
        canvasHeightFt.value = hFeet;
        canvasHeightIn.value = hInches;
      }
      drawGrid();
    });

    [
      canvasWidthFt,
      canvasWidthIn,
      canvasHeightFt,
      canvasHeightIn,
      stencilSizeInput,
      stencilSlider,
      showGridCheckbox,
      gridSubdivisionSelect
    ].forEach(el => {
      el.addEventListener('input', drawGrid);
      el.addEventListener('change', drawGrid);
    });

    window.addEventListener('load', drawGrid);

    // Modal logic
    const previewButton = document.getElementById('previewButton');
    const modal = document.getElementById('modal');
    const modalBg = document.getElementById('modalBg');
    const dropClothCanvas = document.getElementById('dropClothCanvas');
    const dropClothOverlay = document.getElementById('dropClothOverlay');
    const closeModal = document.getElementById('closeModal');

    previewButton.addEventListener('click', () => {
      drawGrid();
      if (!modalBg.complete) {
        modalBg.onload = showModalOverlay;
      } else {
        showModalOverlay();
      }
    });

    function getCleanStencilCanvas() {
      const cellSize = parseFloat(stencilSizeInput.value) * INCH_TO_PX;

      // Get full canvas size in inches
      const { width: clothWidthIn, height: clothHeightIn } = getCanvasDimensionsInInches();
      const pxW = clothWidthIn * INCH_TO_PX;
      const pxH = clothHeightIn * INCH_TO_PX;

      // Prepare rows
      const rows = Array.from(rowInputs.children).map(i => i.value.toUpperCase());

      // Create full-size canvas
      const cleanCanvas = document.createElement('canvas');
      cleanCanvas.width = pxW;
      cleanCanvas.height = pxH;

      const ctx = cleanCanvas.getContext('2d');
      const textureImg = document.getElementById('canvasTexture');

      if (textureImg.complete) {
        const patternCanvas = document.createElement('canvas');
        patternCanvas.width = pxW;
        patternCanvas.height = pxH;
        const pCtx = patternCanvas.getContext('2d');

        // Use pattern fill on temporary canvas
        const pattern = pCtx.createPattern(textureImg, 'repeat');
        if (pattern) {
          pCtx.fillStyle = pattern;
          pCtx.fillRect(0, 0, pxW, pxH);
        }

        // Apply blur while drawing the pattern to the real canvas
        ctx.filter = 'blur(0.8px)';
        ctx.drawImage(patternCanvas, 0, 0);
        ctx.filter = 'none'; // reset
      } else {
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, pxW, pxH);
      }

      // Text settings
      ctx.fillStyle = 'black';
      ctx.strokeStyle = 'black';
      ctx.font = `${cellSize * 1}px "Stardos Stencil", Arial, sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';

      // Center stencil block vertically
      const totalH = rows.length * cellSize;
      const startY = (pxH - totalH) / 2;

      rows.forEach((text, r) => {
        const rowW = text.length * cellSize;
        const startX = (pxW - rowW) / 2;
        const y = startY + r * cellSize;

        for (let c = 0; c < text.length; c++) {
          const x = startX + c * cellSize;
          ctx.strokeRect(x, y, cellSize, cellSize);
          ctx.fillText(text[c], x + cellSize / 2, y + cellSize / 2 + cellSize * 0.15);
        }
      });

      return cleanCanvas;
    }

    function showModalOverlay() {
      modal.style.display = 'flex';

      requestAnimationFrame(() => {
        const bgW = modalBg.clientWidth;
        const bgH = modalBg.clientHeight;

        // Get the drop cloth text canvas
        const stencilCanvas = getCleanStencilCanvas();

        // Calculate real-world scaling
        const stencilWIn = stencilCanvas.width / INCH_TO_PX;
        const stencilHIn = stencilCanvas.height / INCH_TO_PX;

        const pixelsPerFoot = 24;
        const stencilWpx = (stencilWIn / 12) * pixelsPerFoot;
        const stencilHpx = (stencilHIn / 12) * pixelsPerFoot;

        const centerX = (bgW - stencilWpx) / 2;
        const topY = bgH * 0.45 - stencilHpx / 2;

        // Prepare overlay container
        const dropClothOverlay = document.getElementById('dropClothOverlay');
        const dropClothCanvas = document.getElementById('dropClothCanvas');

        dropClothOverlay.style.display = 'block';
        dropClothOverlay.style.left = `${centerX}px`;
        dropClothOverlay.style.top = `${topY}px`;
        dropClothOverlay.style.width = `${stencilWpx}px`;
        dropClothOverlay.style.height = `${stencilHpx}px`;
        dropClothOverlay.style.position = 'absolute';
        dropClothOverlay.style.zIndex = '3';
        dropClothOverlay.style.background = 'rgba(255,255,255,0.95)';
        dropClothOverlay.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
        dropClothOverlay.style.pointerEvents = 'none';

        // Set canvas size and scale
        dropClothCanvas.width = stencilWpx;
        dropClothCanvas.height = stencilHpx;
        dropClothCanvas.style.width = `${stencilWpx}px`;
        dropClothCanvas.style.height = `${stencilHpx}px`;

        const dropCtx = dropClothCanvas.getContext('2d');
        dropCtx.clearRect(0, 0, stencilWpx, stencilHpx);

        // Draw your stencilCanvas into dropClothCanvas (scale to fit)
        dropCtx.drawImage(
          stencilCanvas,
          0, 0, stencilCanvas.width, stencilCanvas.height,
          0, 0, stencilWpx, stencilHpx
        );
      });
    }

    closeModal.addEventListener('click', () => {
      modal.style.display = 'none';
      document.getElementById('dropClothOverlay').style.display = 'none';
    });

    // About modal elements
    const aboutModal = document.getElementById('aboutModal');
    const aboutButton = document.getElementById('aboutButton');
    const closeAboutModal = document.getElementById('closeAboutModal');

    // Function to open modal
    function openAboutModal() {
      aboutModal.style.display = 'flex';
    }

    // Function to close modal + remember dismissal
    function closeAbout() {
      aboutModal.style.display = 'none';
      localStorage.setItem('aboutModalDismissed', 'true');
    }

    // Event listeners
    aboutButton.addEventListener('click', openAboutModal);
    closeAboutModal.addEventListener('click', closeAbout);

    // Open on first visit only
    window.addEventListener('load', () => {
      if (!localStorage.getItem('aboutModalDismissed')) {
        openAboutModal();
      }
    });

    // --- Preview modal (id="modal") ---
    function closePreview() {
      modal.style.display = 'none';
      document.getElementById('dropClothOverlay').style.display = 'none';
    }
    closeModal.addEventListener('click', closePreview);

    // Close when clicking outside the inner content
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closePreview();
    });

    // --- About modal (id="aboutModal") ---
    function closeAbout() {
      aboutModal.style.display = 'none';
      localStorage.setItem('aboutModalDismissed', 'true');
    }
    closeAboutModal.addEventListener('click', closeAbout);

    // Close when clicking outside the inner content
    aboutModal.addEventListener('click', (e) => {
      if (e.target === aboutModal) closeAbout();
    });

    lucide.createIcons();
  </script>

</body>

</html>
